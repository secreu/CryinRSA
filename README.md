# CryinRSA
武大网安2022年秋密码学课程项目：RSA文件加解密系统

### 1 项目说明

本项目基于纯 `Python3` 实现，环境在 `venv` 目录下

选题基于张焕国、唐明老师编著的《密码学引论》(第三版) 246 页第 22 题，将 SM2 改为 RSA 实现。

运行方法为：

1. 直接运行 `exe/main.exe`
2. 直接运行 `main.py`
3. 也可以在 `cryinrsa.py` 下自行编写代码进行使用

有 UI 界面的运行：进入登陆界面后直接点击登录，选择文件进行一次运行的加密和解密，选择密钥功能并未在后端实现 (实际上很简单)，由于未实现该功能，每次运行都只是自行生成了一组特定的密钥，再次运行时未必能够直接正确地解密上一次加密的文件

说正事，项目实现了基本的 RSA 算法过程，实现了 Miller-Rabin 素性判定用于生成大素数，实现了蒙哥马利模幂运算加速加解密过程 (速度远远不如 Python 内置的 pow)。采用 CBC 工作模式，短块填充使用 CBC 模式下的密文挪用。 文件读取采用字节流的方式，理论上可以加密任何格式的文件

以加密文件为例，读取的一小块密文 m 不应该比模数 n 大，否则解密不正确，加密后的密文 c 可能很接近 n，加密方式为：读取 block-1 字节，加密成 block 字节，解密反之，这就是块的定义 (block 是模数 n 的字节数)

### 2 文件说明

`venv/*`：使用 virtualvenv 创建的虚拟环境，使用可以直接运行项目

`exe/*`：使用 pyinstaller 封装的可执行程序

`img/*`：项目 UI 界面使用到的图片资源

`testfile/*`：项目测试用过的测试文件

`cryinrsa.py`：包含 RSA 算法框架和数据处理，为 UI 提供接口

`main.py`：UI 界面设计，使用 tkinter 包 

`modulo.py`：运算库，实现了反复平方、扩展欧几里得、蒙哥马利模运算

`prime.py`：素数库，实现了 Miller-Rabin 素性判定和大素数生成

`test_openssl.py`：效率测试，使用 rsa 和 openssl 包，用于和本项目对比

### 3 一些遗憾——偷懒的证明

#### 3.1 模幂运算

自己实现的蒙哥马利模幂运算速度实在是太低，在实际使用时还是采用了 Python 内置的 pow。具体有多慢？大概就是使用 256 bits 长度的密钥 (p、q的长度)，对 110KB 大小的文件进行加密，用了 8 min，然而同等情况下使用 Python 内置的 pow，只需要 2s

#### 3.2 CBC模式

前面说过，我们加密时将 block-1 字节读取出来，加密后转化成 block 字节存储，使用 CBC 模式会带来一个问题，读者可以不要先往下阅读，思考一下是什么。这个问题会造成解密错误——读取到的 m~2~ (block-1 字节) 和 c~1~ (block 字节) 进行异或之后是 block 字节，它可能会比 n 更大！这就导致无法正确正确解密，解密出来的 m 也就无法保证为 block-1 字节，进行数据转化时 (int 转 bytes) 就会报错

不过这个 CBC 模式是选题要求，最后也是注释掉了就是了，实在懒得再处理了

### 4 致谢

老实说这学期的实验任务真的巨多，从第 4 周开始高强度做实验一直到学期结束，期间还发生了封寝、遣返等影响学习状态的事情，大家都挺不容易的，很难给某一个实验抽出特别多的时间去优化、去完善。

这个项目前后周期不短，可有 3~4 周，但是实际上这 3、4 周并不是只在做这一件事，在这里还是要感谢和我同一组的三位小姐姐，能够一起学习，一起进步，一起写实验报告，最后完成这个课程项目
